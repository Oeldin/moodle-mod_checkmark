{"version":3,"sources":["../src/settings.js"],"names":["define","$","log","Settings","dividingSymbol","prototype","updateSettings","e","gradeSum","i","data","stripper","pointSelector","flexibleNamingSelector","exampleGradesSelector","exampleNamesSelector","val","prop","regex1","RegExp","replace","type","regex2","regex3","tempString","tempArray","split","length","parseInt","which","regex","instance","initializer","config","info","exampleCountSelector","click","change","blur","keyup"],"mappings":"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","sourcesContent":["// This file is part of mod_checkmark for Moodle - http://moodle.org/\r\n//\r\n// It is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// It is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * settings.js\r\n *\r\n * @package   mod_checkmark\r\n * @author    Philipp Hager\r\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n /**\r\n  * @module mod_checkmark/settings\r\n  */\r\ndefine(['jquery', 'core/log'], function($, log) {\r\n\r\n    /**\r\n     * @constructor\r\n     * @alias module:mod_checkmark/settings\r\n     */\r\n    var Settings = function() {\r\n        this.dividingSymbol = ',';\r\n    };\r\n\r\n    /**\r\n     * UpdateSettings updates the grade-selector appropriate to the given\r\n     * individual grades (flexiblenaming = 1) or the given amount of examples (flexiblenaming = 0)\r\n     *\r\n     * @param {Event} e event object\r\n     * @return {bool} true if everything's allright (no error handling by now)\r\n     */\r\n    Settings.prototype.updateSettings = function(e) {\r\n        var gradeSum = 0;\r\n        var i = 0;\r\n\r\n        // First we strip everything we don't need!\r\n        e.data.stripper(e);\r\n\r\n        var typeSelector = '#id_grade_modgrade_type';\r\n        var pointSelector = '#id_grade_modgrade_point';\r\n        var flexibleNamingSelector = '#id_flexiblenaming';\r\n        var exampleGradesSelector = '#id_examplegrades';\r\n        var exampleNamesSelector = '#id_examplenames';\r\n        var exampleCountSelector = '#id_examplecount';\r\n\r\n        // If non-numeric scales are used or checkmark isn't graded at all, ignore changes!\r\n        if ($(typeSelector).val() !== 'point') {\r\n            return true;\r\n        }\r\n        if ($(flexibleNamingSelector).prop('checked')) {\r\n            // Calculate gradesum using individual grades list!\r\n            // Replace occurences of more than 1 comma in row through a single one...\r\n            var regex1 = new RegExp(e.data.dividingSymbol + \"{2,}\", \"g\");\r\n            $(exampleGradesSelector).val($(exampleGradesSelector).val().replace(regex1, e.data.dividingSymbol));\r\n            // Strip trailling and following commata!\r\n            if (e.type !== 'valuechange') {\r\n                var regex2 = new RegExp(\"^\" + e.data.dividingSymbol + \"*|\" + e.data.dividingSymbol + \"*$\", \"g\");\r\n                $(exampleGradesSelector).val($(exampleGradesSelector).val().replace(regex2, \"\"));\r\n                $(exampleNamesSelector).val($(exampleNamesSelector).val().replace(regex2, \"\"));\r\n            }\r\n            // Get string and strip every character except \",\" (comma) and numerics!\r\n            var regex3 = new RegExp(\"[^0-9\" + e.data.dividingSymbol + \"]\");\r\n            var tempString = $(exampleGradesSelector).val().replace(regex3, \"\");\r\n            var tempArray = tempString.split(e.data.dividingSymbol);\r\n            for (i = 0; i < tempArray.length; i++) {\r\n                if (tempArray[i].replace(/[^\\d]/g, \"\") !== \"\") {\r\n                    gradeSum += parseInt(tempArray[i].replace(/[^\\d]/g, \"\"));\r\n                }\r\n            }\r\n        } else {\r\n            // Calculate gradesum using example-amount (each example counts 1 point)!\r\n            gradeSum = $(exampleCountSelector).val();\r\n        }\r\n\r\n        if (!$(flexibleNamingSelector).prop('checked')) {\r\n            if ($(pointSelector).val() % gradeSum === 0) {\r\n                // Grade is integral multiple of gradesum (= examplecount) so everything's fine!\r\n                return true;\r\n            }\r\n        }\r\n        if ((gradeSum <= 100) && (gradeSum > 0)) {\r\n            $(typeSelector).val('point');\r\n            $(pointSelector).val(gradeSum);\r\n        } else if (gradeSum < 0) {\r\n            $(typeSelector).val('scale');\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Strips unwanted characters from examplegrades field!\r\n     *\r\n     * @param {Event} e event object\r\n     * @returns {boolean} true if everything's OK\r\n     */\r\n    Settings.prototype.stripper = function(e) {\r\n        if ((e !== null) && (e.which <= 46)) { // That means: no written character!\r\n            return true;\r\n        }\r\n        var exampleGradesSelector = '#examplegrades';\r\n        if (!$(exampleGradesSelector).length) {\r\n            // Compatibility to pre 2.2 and current needed ID - TODO: do we need this anymore?\r\n            exampleGradesSelector = '#id_examplegrades';\r\n        }\r\n\r\n        var regex = new RegExp(\"[^0-9\" + e.data.dividingSymbol + \"]\", \"g\");\r\n        $(exampleGradesSelector).val($(exampleGradesSelector).val().replace(regex, \"\"));\r\n        return true;\r\n    };\r\n\r\n    var instance = new Settings();\r\n\r\n    /**\r\n     * Initializer prepares settings form for JS-functionality\r\n     *\r\n     * @param {Array} config contains object with all examples\r\n     * @return {bool} true if everything's ok (no error-handling implemented)\r\n     */\r\n    instance.initializer = function(config) {\r\n        instance.dividingSymbol = config.dividingSymbol;\r\n\r\n        log.info('Initialize settings JS', 'checkmark');\r\n\r\n        var typeSelector = '#id_grade_modgrade_type';\r\n        var flexibleNamingSelector = \"#id_flexiblenaming\";\r\n        var exampleGradesSelector = \"#id_examplegrades\";\r\n        var exampleNamesSelector = \"#id_examplenames\";\r\n        var exampleCountSelector = \"#id_examplecount\";\r\n        $(flexibleNamingSelector).click(instance, instance.updateSettings);\r\n        $(typeSelector).change(instance, instance.updateSettings);\r\n        $(exampleGradesSelector).change(instance, instance.updateSettings);\r\n        $(exampleNamesSelector).change(instance, instance.updateSettings);\r\n        $(exampleCountSelector).change(instance, instance.updateSettings);\r\n        $(exampleGradesSelector).blur(instance, instance.updateSettings);\r\n        $(exampleNamesSelector).blur(instance, instance.updateSettings);\r\n        $(exampleCountSelector).blur(instance, instance.updateSettings);\r\n        $(exampleGradesSelector).keyup(instance, instance.stripper);\r\n\r\n        if ($(\"input[name=allready_submit]\").val() === 'no') {\r\n            instance.updateSettings({data: instance});\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    return instance;\r\n});\r\n"],"file":"settings.min.js"}